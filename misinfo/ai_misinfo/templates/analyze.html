<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Misinformation Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f9f9f9; }
    .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .result { margin-top: 20px; }
    .fake { color: red; font-weight: bold; }
    .real { color: green; font-weight: bold; }
    .uncertain { color: orange; font-weight: bold; }
  </style>
</head>
<body class="container py-4">

  <h2 class="text-center mb-4">ü§ñ AI-Powered Misinformation Analyzer</h2>

  <div class="card p-4">
    <form id="analyzeForm">
      <div class="mb-3">
        <label class="form-label">Input Type</label>
        <select id="input_type" class="form-select" required>
          <option value="text">Text</option>
          <option value="url">URL</option>
          <option value="image">Image</option>
        </select>
      </div>

      <div class="mb-3" id="text-input">
        <label class="form-label">Enter Text</label>
        <textarea id="text" class="form-control" rows="3"></textarea>
      </div>

      <div class="mb-3 d-none" id="url-input">
        <label class="form-label">Enter URL</label>
        <input type="url" id="url" class="form-control">
      </div>

      <div class="mb-3 d-none" id="image-input">
        <label class="form-label">Upload Image</label>
        <input type="file" id="image" class="form-control" accept="image/*">
      </div>

      <!-- Buttons -->
      <button type="submit" class="btn btn-primary w-100 mb-2">Analyze</button>
      <a href="/dashboard/" class="btn btn-secondary w-100">üìä View Dashboard</a>
    </form>
  </div>

  <div id="result" class="result"></div>

  <script>
    const inputTypeEl = document.getElementById("input_type");
    const textInput = document.getElementById("text-input");
    const urlInput = document.getElementById("url-input");
    const imageInput = document.getElementById("image-input");
    const resultDiv = document.getElementById("result");

    inputTypeEl.addEventListener("change", () => {
      textInput.classList.add("d-none");
      urlInput.classList.add("d-none");
      imageInput.classList.add("d-none");
      if (inputTypeEl.value === "text") textInput.classList.remove("d-none");
      if (inputTypeEl.value === "url") urlInput.classList.remove("d-none");
      if (inputTypeEl.value === "image") imageInput.classList.remove("d-none");
    });

    document.getElementById("analyzeForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData();
      formData.append("input_type", inputTypeEl.value);

      if (inputTypeEl.value === "text") {
        formData.append("text", document.getElementById("text").value);
      } else if (inputTypeEl.value === "url") {
        formData.append("url", document.getElementById("url").value);
      } else if (inputTypeEl.value === "image") {
        formData.append("image", document.getElementById("image").files[0]);
      }

      resultDiv.innerHTML = `<div class="text-center text-muted">‚è≥ Analyzing...</div>`;

      try {
        const res = await fetch("/api/analyze/", { method: "POST", body: formData });
        const data = await res.json();

        if (data.error) {
          resultDiv.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${data.error} <br>Details: ${data.details || ""}</div>`;
          return;
        }

        let verdictClass = data.status_text === "Real" ? "real" : data.status_text === "Fake" ? "fake" : "uncertain";

        resultDiv.innerHTML = `
          <div class="card p-4">
            <h5>Verdict: <span class="${verdictClass}">${data.status_text}</span></h5>
            <p><strong>Confidence:</strong> ${Math.round((data.confidence || 0) * 100)}%</p>
            <p><strong>Summary:</strong> ${data.brief_summary}</p>
            <p><strong>Education Tips:</strong></p>
            <ul>${(data.education || []).map(t => `<li>${t}</li>`).join("")}</ul>
            ${(data.factcheck_links || []).length ? `
              <p><strong>Fact-check Sources:</strong></p>
              <ul>${data.factcheck_links.map(l => `<li><a href="${l}" target="_blank">${l}</a></li>`).join("")}</ul>
            ` : ""}
          </div>
        `;
      } catch (err) {
        resultDiv.innerHTML = `<div class="alert alert-danger">‚ùå Failed: ${err}</div>`;
      }
    });
  </script>
</body>
</html>
